/*! For license information please see trash.js.LICENSE.txt */
(()=>{"use strict";var e={1402:(e,t,r)=>{r.d(t,{Z:()=>qe});var n=r(8081),o=r.n(n),a=r(3645),i=r.n(a),c=r(1667),l=r.n(c),u=new URL(r(3523),r.b),s=new URL(r(8349),r.b),f=new URL(r(137),r.b),h=new URL(r(2024),r.b),p=new URL(r(3177),r.b),y=new URL(r(5324),r.b),d=new URL(r(8896),r.b),v=new URL(r(1034),r.b),m=new URL(r(9980),r.b),b=new URL(r(9265),r.b),g=new URL(r(2830),r.b),w=new URL(r(3303),r.b),L=new URL(r(1227),r.b),x=new URL(r(815),r.b),k=new URL(r(4263),r.b),C=new URL(r(5350),r.b),P=new URL(r(1692),r.b),E=new URL(r(4832),r.b),O=new URL(r(6639),r.b),S=new URL(r(1530),r.b),j=new URL(r(2109),r.b),T=new URL(r(4609),r.b),_=new URL(r(3967),r.b),R=new URL(r(5491),r.b),A=new URL(r(9754),r.b),U=new URL(r(5237),r.b),G=new URL(r(2608),r.b),M=new URL(r(1947),r.b),N=new URL(r(6266),r.b),D=new URL(r(8589),r.b),I=new URL(r(8757),r.b),z=new URL(r(2110),r.b),F=new URL(r(3636),r.b),B=new URL(r(8299),r.b),Y=new URL(r(6136),r.b),q=new URL(r(9618),r.b),$=new URL(r(3010),r.b),H=new URL(r(9937),r.b),W=new URL(r(9030),r.b),Z=new URL(r(7345),r.b),J=new URL(r(8956),r.b),Q=new URL(r(5153),r.b),K=new URL(r(8269),r.b),V=new URL(r(5316),r.b),X=i()(o()),ee=l()(u),te=l()(s),re=l()(f),ne=l()(h),oe=l()(p),ae=l()(y),ie=l()(d),ce=l()(v),le=l()(m),ue=l()(b),se=l()(g),fe=l()(w),he=l()(L),pe=l()(x),ye=l()(k),de=l()(C),ve=l()(P),me=l()(E),be=l()(O),ge=l()(S),we=l()(j),Le=l()(T),xe=l()(_),ke=l()(R),Ce=l()(A),Pe=l()(U),Ee=l()(G),Oe=l()(M),Se=l()(N),je=l()(D),Te=l()(I),_e=l()(z),Re=l()(F),Ae=l()(B),Ue=l()(Y),Ge=l()(q),Me=l()($),Ne=l()(H),De=l()(W),Ie=l()(Z),ze=l()(J),Fe=l()(Q),Be=l()(K),Ye=l()(V);X.push([e.id,":root {\r\n  --cell-size: 64px;\r\n}\r\n\r\nhtml,\r\nbody {\r\n  height: 100%;\r\n  margin: 0;\r\n}\r\n\r\nbody {\r\n  background: #000;\r\n  font-size: 16px;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  font-weight: 400;\r\n  color: #212529;\r\n  background-color: #f8f9fa;\r\n  text-align: center;\r\n  vertical-align: middle;\r\n  padding: 0.375rem 0.75rem;\r\n  font-size: 1rem;\r\n  line-height: 1.5;\r\n  border-radius: 0.25rem;\r\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out,\r\n    border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\r\n  border: none;\r\n}\r\n\r\n.controls {\r\n  text-align: center;\r\n  margin: 50px 0;\r\n}\r\n\r\n.board-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.board {\r\n  position: relative;\r\n  display: grid;\r\n  grid-template-columns: repeat(8, 1fr);\r\n  grid-column-gap: 2px;\r\n  grid-row-gap: 2px;\r\n}\r\n\r\n.cell {\r\n  position: relative;\r\n}\r\n\r\n.cell.selected::before {\r\n  content: '';\r\n  display: block;\r\n  border: 4px;\r\n  border-radius: 32px;\r\n  box-sizing: border-box;\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  opacity: 0.9;\r\n  position: absolute;\r\n}\r\n\r\n.cell.selected-yellow::before {\r\n  border-color: #ff0;\r\n  border-style: solid;\r\n}\r\n\r\n.cell.selected-green::before {\r\n  border-color: #0f0;\r\n  border-style: dashed;\r\n}\r\n\r\n.cell.selected-red::before {\r\n  border-color: #f00;\r\n  border-style: solid;\r\n}\r\n\r\n.cell.selected-red-dashed::before {\r\n  border-color: #f00;\r\n  border-style: dashed;\r\n}\r\n\r\n.board.prairie {\r\n  --map-tile-top-left-url: url("+ee+");\r\n  --map-tile-top-url: url("+te+");\r\n  --map-tile-top-right-url: url("+re+");\r\n  --map-tile-bottom-left-url: url("+ne+");\r\n  --map-tile-bottom-url: url("+oe+");\r\n  --map-tile-bottom-right-url: url("+ae+");\r\n  --map-tile-left-url: url("+ie+");\r\n  --map-tile-right-url: url("+ce+");\r\n  --map-tile-center-url: url("+le+");\r\n}\r\n\r\n.board.desert {\r\n  --map-tile-top-left-url: url("+ue+");\r\n  --map-tile-top-url: url("+se+");\r\n  --map-tile-top-right-url: url("+fe+");\r\n  --map-tile-bottom-left-url: url("+he+");\r\n  --map-tile-bottom-url: url("+pe+");\r\n  --map-tile-bottom-right-url: url("+ye+");\r\n  --map-tile-left-url: url("+de+");\r\n  --map-tile-right-url: url("+ve+");\r\n  --map-tile-center-url: url("+me+");\r\n}\r\n\r\n.board.arctic {\r\n  --map-tile-top-left-url: url("+be+");\r\n  --map-tile-top-url: url("+ge+");\r\n  --map-tile-top-right-url: url("+we+");\r\n  --map-tile-bottom-left-url: url("+Le+");\r\n  --map-tile-bottom-url: url("+xe+");\r\n  --map-tile-bottom-right-url: url("+ke+");\r\n  --map-tile-left-url: url("+Ce+");\r\n  --map-tile-right-url: url("+Pe+");\r\n  --map-tile-center-url: url("+Ee+");\r\n}\r\n\r\n.board.mountain {\r\n  --map-tile-top-left-url: url("+Oe+");\r\n  --map-tile-top-url: url("+Se+");\r\n  --map-tile-top-right-url: url("+je+");\r\n  --map-tile-bottom-left-url: url("+Te+");\r\n  --map-tile-bottom-url: url("+_e+");\r\n  --map-tile-bottom-right-url: url("+Re+");\r\n  --map-tile-left-url: url("+Ae+");\r\n  --map-tile-right-url: url("+Ue+");\r\n  --map-tile-center-url: url("+Ge+");\r\n}\r\n\r\n.map-tile {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n}\r\n\r\n.map-tile-top-left {\r\n  background: var(--map-tile-top-left-url);\r\n}\r\n\r\n.map-tile-top {\r\n  background: var(--map-tile-top-url);\r\n}\r\n\r\n.map-tile-top-right {\r\n  background: var(--map-tile-top-right-url);\r\n}\r\n\r\n.map-tile-bottom-left {\r\n  background: var(--map-tile-bottom-left-url);\r\n}\r\n\r\n.map-tile-bottom {\r\n  background: var(--map-tile-bottom-url);\r\n}\r\n\r\n.map-tile-bottom-right {\r\n  background: var(--map-tile-bottom-right-url);\r\n}\r\n\r\n.map-tile-left {\r\n  background: var(--map-tile-left-url);\r\n}\r\n\r\n.map-tile-right {\r\n  background: var(--map-tile-right-url);\r\n}\r\n\r\n.map-tile-center {\r\n  background: var(--map-tile-center-url);\r\n}\r\n\r\n.character {\r\n  width: var(--cell-size);\r\n  height: var(--cell-size);\r\n  position: absolute;\r\n  z-index: 99;\r\n}\r\n\r\n.character.generic {\r\n  background: url("+Me+");\r\n}\r\n\r\n.character.bowman {\r\n  background: url("+Ne+");\r\n}\r\n\r\n.character.daemon {\r\n  background: url("+De+");\r\n}\r\n\r\n.character.magician {\r\n  background: url("+Ie+");\r\n}\r\n\r\n.character.swordman {\r\n  background: url("+ze+");\r\n}\r\n\r\n.character.undead {\r\n  background: url("+Fe+");\r\n}\r\n\r\n.character.vampire {\r\n  background: url("+Be+");\r\n}\r\n\r\n.character.zombie {\r\n  background: url("+Ye+");\r\n}\r\n\r\n.health-level {\r\n  top: 2px;\r\n  left: 7px;\r\n  position: absolute;\r\n  width: 50px;\r\n  height: 4px;\r\n  background: #000;\r\n}\r\n\r\n.health-level-indicator {\r\n  height: 4px;\r\n}\r\n\r\n.health-level-indicator-high {\r\n  background: #0f0;\r\n}\r\n\r\n.health-level-indicator-normal {\r\n  background: #ff0;\r\n}\r\n\r\n.health-level-indicator-critical {\r\n  background: #f00;\r\n}\r\n\r\n.damage {\r\n  display: block;\r\n  position: absolute;\r\n  width: var(--cell-size);\r\n  text-align: center;\r\n  z-index: 999;\r\n  color: #f00;\r\n  font-weight: bold;\r\n  animation: 500ms animationDamage ease-out;\r\n  user-select: none;\r\n  -webkit-animation: 500ms animationDamage ease-out;\r\n}\r\n\r\n.user-points {\r\n  color: #fff;\r\n  text-align: center;\r\n  margin-top: 2rem;\r\n}\r\n\r\n@keyframes animationDamage {\r\n  from {\r\n    opacity: 0;\r\n    transform: translate(0, calc(var(--cell-size) * 0.5));\r\n    font-size: 1rem;\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translate(0, -20px);\r\n    font-size: 1.5rem;\r\n  }\r\n}\r\n",""]);const qe=X},3645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(i[l]=!0)}for(var u=0;u<e.length;u++){var s=[].concat(e[u]);n&&i[s[0]]||(void 0!==a&&(void 0===s[5]||(s[1]="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {").concat(s[1],"}")),s[5]=a),r&&(s[2]?(s[1]="@media ".concat(s[2]," {").concat(s[1],"}"),s[2]=r):s[2]=r),o&&(s[4]?(s[1]="@supports (".concat(s[4],") {").concat(s[1],"}"),s[4]=o):s[4]="".concat(o)),t.push(s))}},t}},1667:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:e=>{e.exports=function(e){return e[1]}},3379:e=>{var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var a={},i=[],c=0;c<e.length;c++){var l=e[c],u=n.base?l[0]+n.base:l[0],s=a[u]||0,f="".concat(u," ").concat(s);a[u]=s+1;var h=r(f),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var y=o(p,n);n.byIndex=c,t.splice(c,0,{identifier:f,updater:y,references:1})}i.push(f)}return i}function o(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,o){var a=n(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=r(a[i]);t[c].references--}for(var l=n(e,o),u=0;u<a.length;u++){var s=r(a[u]);0===t[s].references&&(t[s].updater(),t.splice(s,1))}a=l}}},569:e=>{var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},9216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,o&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var a=r.sourceMap;a&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4609:(e,t,r)=>{e.exports=r.p+"b27323cf850ed820855c.png"},5491:(e,t,r)=>{e.exports=r.p+"ac9d74f57639792774bc.png"},3967:(e,t,r)=>{e.exports=r.p+"63aae58e4690953a3857.png"},2608:(e,t,r)=>{e.exports=r.p+"246277b8ca590816b3e8.png"},9754:(e,t,r)=>{e.exports=r.p+"3d9503e0a850fda86f82.png"},5237:(e,t,r)=>{e.exports=r.p+"22e7c5ede3f747cbe27a.png"},6639:(e,t,r)=>{e.exports=r.p+"eab6a2cc5e89a4dd8e3f.png"},2109:(e,t,r)=>{e.exports=r.p+"d31d84c693f649766aee.png"},1530:(e,t,r)=>{e.exports=r.p+"e0aa3daf6d08c62c96d9.png"},9937:(e,t,r)=>{e.exports=r.p+"cec542854b228e61547a.png"},9030:(e,t,r)=>{e.exports=r.p+"cf170a9fea1051b7424a.png"},3010:(e,t,r)=>{e.exports=r.p+"0a77fc47d727eab6fd39.png"},7345:(e,t,r)=>{e.exports=r.p+"c0fa2b75539f94144dc4.png"},8956:(e,t,r)=>{e.exports=r.p+"2007ec00c1d9f997e704.png"},5153:(e,t,r)=>{e.exports=r.p+"f5c75398bcb5931f9f3c.png"},8269:(e,t,r)=>{e.exports=r.p+"bf0ed0dca1d1e6091d42.png"},5316:(e,t,r)=>{e.exports=r.p+"296dfeac15e2377fc1dc.png"},1227:(e,t,r)=>{e.exports=r.p+"13edb269e39172ddd74f.png"},4263:(e,t,r)=>{e.exports=r.p+"5cf9c17d6a1ea7106a6c.png"},815:(e,t,r)=>{e.exports=r.p+"f1703771380a9959d979.png"},4832:(e,t,r)=>{e.exports=r.p+"51e2a5de56bd631452fe.png"},5350:(e,t,r)=>{e.exports=r.p+"eb1f6e4f87b977012684.png"},1692:(e,t,r)=>{e.exports=r.p+"2c19971f327b288278bb.png"},9265:(e,t,r)=>{e.exports=r.p+"258d884122fabfc2f312.png"},3303:(e,t,r)=>{e.exports=r.p+"2f1e1970c2c20cf3a8d5.png"},2830:(e,t,r)=>{e.exports=r.p+"dc3f97e7bbcd5ea1ded9.png"},8757:(e,t,r)=>{e.exports=r.p+"1d70f1dab2dd418c3612.png"},3636:(e,t,r)=>{e.exports=r.p+"6bacb8e25ed9ecf726bf.png"},2110:(e,t,r)=>{e.exports=r.p+"f462d2ed6eedca1e4fd9.png"},9618:(e,t,r)=>{e.exports=r.p+"6f6f7c09bde970b2e41b.png"},8299:(e,t,r)=>{e.exports=r.p+"c75f062dddba6e98fdc6.png"},6136:(e,t,r)=>{e.exports=r.p+"26fdc25019c24e87f11a.png"},1947:(e,t,r)=>{e.exports=r.p+"ef1b0ea8c4e545d9aadc.png"},8589:(e,t,r)=>{e.exports=r.p+"a1d2321024649b9d8f5f.png"},6266:(e,t,r)=>{e.exports=r.p+"8b928c3eb136543e573a.png"},2024:(e,t,r)=>{e.exports=r.p+"26b5f224d8750119922d.png"},5324:(e,t,r)=>{e.exports=r.p+"2429af6d3a5796e3c34b.png"},3177:(e,t,r)=>{e.exports=r.p+"07d5e8127645225478b6.png"},9980:(e,t,r)=>{e.exports=r.p+"0089a610e6611f679b50.png"},8896:(e,t,r)=>{e.exports=r.p+"546abb060a0837550fd1.png"},1034:(e,t,r)=>{e.exports=r.p+"6a84ae91f5d985ddc9ee.png"},3523:(e,t,r)=>{e.exports=r.p+"46d63299c3420c030b4e.png"},137:(e,t,r)=>{e.exports=r.p+"0ac7f8258ec7166dc957.png"},8349:(e,t,r)=>{e.exports=r.p+"946aeb948db6313f1d85.png"}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={id:n,exports:{}};return e[n](a,a.exports,r),a.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r.b=document.baseURI||self.location.href,r.nc=void 0,(()=>{var e=r(3379),t=r.n(e),n=r(7795),o=r.n(n),a=r(569),i=r.n(a),c=r(3565),l=r.n(c),u=r(9216),s=r.n(u),f=r(4589),h=r.n(f),p=r(1402),y={};y.styleTagTransform=h(),y.setAttributes=l(),y.insert=i().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=s(),t()(p.Z,y),p.Z&&p.Z.locals&&p.Z.locals;const d=r.p+"ca4a9d1b2b60a55b6d8d36be3cce6b68.mp3",v={1:"prairie",2:"desert",3:"arctic",4:"mountain"};function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=b(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function b(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[],this.playerFrozen=!1,this.audio=new Audio(d)}var t,r;return t=e,r=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(e){var t,r,n=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n      <div class="game-stats">\n        <div class="user-points"> Your points: 0</div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(e){return n.onNewGameClick(e)})),this.saveGameEl.addEventListener("click",(function(e){return n.onSaveGameClick(e)})),this.loadGameEl.addEventListener("click",(function(e){return n.onLoadGameClick(e)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var o=0;o<Math.pow(this.boardSize,2);o+=1){var a=document.createElement("div");a.classList.add("cell","map-tile","map-tile-".concat((t=o,r=this.boardSize,0===t?"top-left":t>0&&t<r-1?"top":t===r-1?"top-right":t===r*(r-1)?"bottom-left":t>r*(r-1)&&t<r*r-1?"bottom":t===r*r-1?"bottom-right":t%r==0&&0!==t&&t!==r*(r-1)?"left":t%r==7&&t!==r-1&&t!==r*r-1?"right":"center"))),a.addEventListener("mouseenter",(function(e){return n.onCellEnter(e)})),a.addEventListener("mouseleave",(function(e){return n.onCellLeave(e)})),a.addEventListener("click",(function(e){return n.onCellClick(e)})),this.boardEl.appendChild(a)}this.cells=Array.from(this.boardEl.querySelectorAll(".cell"))}},{key:"changeTheme",value:function(e){for(var t in v)this.boardEl.classList.remove(v[t]);this.boardEl.classList.add(v[e])}},{key:"redrawPositions",value:function(e){var t,r=m(this.cells);try{for(r.s();!(t=r.n()).done;)t.value.innerHTML=""}catch(e){r.e(e)}finally{r.f()}var n,o,a=m(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,c=i.position,l=i.character,u=this.cells[c],s=document.createElement("div");s.classList.add("character",l.type,l.side);var f=document.createElement("div");f.classList.add("health-level");var h=document.createElement("div");h.classList.add("health-level-indicator","health-level-indicator-".concat((o=l.health)<15?"critical":o<50?"normal":"high")),h.style.width="".concat(l.health,"%"),f.appendChild(h),s.appendChild(f),u.appendChild(s)}}catch(e){a.e(e)}finally{a.f()}}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListeners.push(e)}},{key:"addSaveGameListener",value:function(e){this.saveGameListeners.push(e)}},{key:"addLoadGameListener",value:function(e){this.loadGameListeners.push(e)}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.lastEnteredCellIndex=t,this.playerFrozen||this.cellEnterListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.playerFrozen||this.cellLeaveListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.playerFrozen||this.cellClickListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListeners.forEach((function(e){return e.call(null)}))}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListeners.forEach((function(e){return e.call(null)}))}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListeners.forEach((function(e){return e.call(null)}))}},{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,r,n=this.cells[e];(t=n.classList).remove.apply(t,function(e){if(Array.isArray(e))return g(e)}(r=Array.from(n.classList).filter((function(e){return e.startsWith("selected")})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||b(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var r=this;return new Promise((function(n){var o=r.cells[e],a=o.offsetTop,i=o.offsetLeft,c=document.createElement("span");c.textContent=t,c.classList.add("damage"),c.style.top="".concat(a,"px"),c.style.left="".concat(i,"px"),o.insertAdjacentElement("afterend",c),c.addEventListener("animationend",(function(){c.remove(),n()}))}))}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}},{key:"addSong",value:function(){this.audio.currentTime=0,this.audio.preload="auto",this.audio.loop=!0,this.audio.pause(),this.audio.play()}}],r&&w(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function k(){k=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),c=new O(o||[]);return n(i,"_invoke",{value:L(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f={};function h(){}function p(){}function y(){}var d={};l(d,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==t&&r.call(m,a)&&(d=m);var b=y.prototype=h.prototype=Object.create(d);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(n,a,i,c){var l=s(e[n],e,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==x(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,i,c)}),(function(e){o("throw",e,i,c)})):t.resolve(f).then((function(e){u.value=e,i(u)}),(function(e){return o("throw",e,i,c)}))}c(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=C(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function C(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=y,n(b,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:p,configurable:!0}),p.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},g(w.prototype),l(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},g(b),l(b,c,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=S,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;E(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function C(e,t){if(e){if("string"==typeof e)return P(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(e,t):void 0}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var O=function(e){function t(e){var r=e.side,n=e.allowedTypes,o=e.maxLevel,a=e.characterCount;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.side=r,this.characters=[],this.addNewCharacter(n,o,a),console.log(n)}var r,n;return r=t,(n=[{key:Symbol.iterator,value:k().mark((function e(){var t,r,n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.characters,r=t.length,n=0;case 3:if(!(n<r)){e.next=9;break}return e.next=6,(o=t,function(e){if(Array.isArray(e))return P(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||C(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[n];case 6:n++,e.next=3;break;case 9:case"end":return e.stop()}var o}),e,this)}))},{key:"length",get:function(){return this.characters.length}},{key:"characterGenerator",value:function(e,t){return new(0,e[Math.floor(Math.random()*e.length)])(Math.floor(Math.random()*t+1))}},{key:"addNewCharacter",value:function(e,t,r){for(var n=1;n<=r;n++){var o=this.characterGenerator(e,t,this);this.characters.push(o)}}},{key:"removeCharacter",value:function(e){var t=this.characters.findIndex((function(t){return t===e}));-1!==t&&this.characters.splice(t,1)}},{key:"charactersLevelUp",value:function(){var e,t=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=C(e))){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}(this.characters);try{for(t.s();!(e=t.n()).done;)e.value.levelUp()}catch(e){t.e(e)}finally{t.f()}}}])&&E(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),t}();function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var T=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(S(this,e),this.level=t,this.attack=0,this.defence=0,this._health=50,this.type=r,"Character"===(this instanceof e?this.constructor:void 0).name)throw new Error("Dude, stop call dat. Call already created characters.")}var t,r;return t=e,(r=[{key:"health",get:function(){return this._health},set:function(e){this._health=e,this._health>100&&(this._health=100),this._health<=0&&(this._health=0)}},{key:"calculateDamage",value:function(e){var t=Math.max(this.attack-e.defence,.1*this.attack);return Math.ceil(t)}},{key:"increaseStats",value:function(e){var t=Math.max(this[e],this[e]*(80+this.health)/100);this[e]=Math.floor(t)}},{key:"levelUp",value:function(){this.level+=1,this.health+=80,this.increaseStats("attack"),this.increaseStats("defence")}},{key:"levelUpNewCharacter",value:function(){for(var e=1;e<this.level;e++)this.increaseStats("attack"),this.increaseStats("defence")}}])&&j(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function U(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(r);if(n){var o=G(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return U(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bowman";return R(this,a),(t=o.call(this,e,r)).attack=25,t.defence=25,t.attackRange=2,t.moveRange=2,t.side="player",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}function z(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=F(r);if(n){var o=F(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return z(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"daemon";return D(this,a),(t=o.call(this,e,r)).attack=10,t.defence=10,t.attackRange=4,t.moveRange=1,t.side="enemy",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function H(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(r);if(n){var o=W(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return H(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"magician";return q(this,a),(t=o.call(this,e,r)).attack=10,t.defence=40,t.attackRange=4,t.moveRange=1,t.side="player",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function V(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function X(e){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},X(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(r);if(n){var o=X(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return V(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"swordman";return Q(this,a),(t=o.call(this,e,r)).attack=40,t.defence=10,t.attackRange=1,t.moveRange=4,t.side="player",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}function oe(e,t){if(t&&("object"===te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ae(e){return ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ae(e)}var ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ae(r);if(n){var o=ae(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return oe(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undead";return re(this,a),(t=o.call(this,e,r)).attack=40,t.defence=10,t.attackRange=1,t.moveRange=4,t.side="enemy",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function le(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function se(e,t){if(t&&("object"===ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}var he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ue(e,t)}(a,e);var t,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fe(r);if(n){var o=fe(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return se(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vampire";return le(this,a),(t=o.call(this,e,r)).attack=25,t.defence=25,t.attackRange=2,t.moveRange=2,t.side="enemy",t.levelUpNewCharacter(),t}return t=a,Object.defineProperty(t,"prototype",{writable:!1}),t}(T);function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ye(e,t,r){return t&&pe(e.prototype,t),r&&pe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var de=ye((function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof T))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=t,this.position=r}));function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var me=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.gameController=r}var t,r;return t=e,(r=[{key:"calcPosByDifference",value:function(e,t){var r=t.verticalDifference;return e+t.horizontalDifference+r*this.gamePlay.boardSize}},{key:"calcDistance",value:function(e,t){var r=this.gamePlay.boardSize,n=Math.floor(t/r)-Math.floor(e/r),o=t%r-e%r;return{distance:Math.max(Math.abs(n),Math.abs(o)),verticalDifference:n,horizontalDifference:o}}},{key:"moveCharacter",value:function(e,t){this.gamePlay.deselectCell(e.position),e.position=t,this.gameController.redrawPositions()}},{key:"availableForMoveCell",value:function(e,t){var r=e.character,n=e.position,o=this.calcDistance(n,t).distance;return this.gameController.emptyCell(t)&&r.moveRange>=o}}])&&ve(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();const be="auto",ge="pointer",we="crosshair",Le="not-allowed";function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function ke(){ke=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),c=new P(o||[]);return n(i,"_invoke",{value:L(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f={};function h(){}function p(){}function y(){}var d={};l(d,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==t&&r.call(m,a)&&(d=m);var b=y.prototype=h.prototype=Object.create(d);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(n,a,i,c){var l=s(e[n],e,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==xe(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,i,c)}),(function(e){o("throw",e,i,c)})):t.resolve(f).then((function(e){u.value=e,i(u)}),(function(e){return o("throw",e,i,c)}))}c(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=x(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=y,n(b,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:p,configurable:!0}),p.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},g(w.prototype),l(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},g(b),l(b,c,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function Ce(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ee(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function Oe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ee(a,n,o,i,c,"next",e)}function c(e){Ee(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var je=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gameController=t,this.movement=t.movement,this.potentialActions=[],this.delay=200}var t,r,n;return t=e,r=[{key:"doAction",value:(n=Oe(ke().mark((function e(){var t=this;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.potentialActions=[];var r=t.gameController.getTeamPositions("enemy");t.playerCharacters=t.gameController.getTeamPositions("player");var n,o=Ce(r);try{for(o.s();!(n=o.n()).done;){var a=n.value;t.pushCharActions(a)}}catch(e){o.e(e)}finally{o.f()}var i=t.findBestAction(t.potentialActions);t.performBestAction(i).then((function(){setTimeout((function(){t.gameController.deselectEnemyCharacter()}),t.delay),e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"performBestAction",value:function(e){var t=this;return new Promise((function(r){var n=e.actor,o=e.target;t.gameController.selectEnemyCharacter(n.position),t.gameController.availableForAttackCell(n,o.position)?setTimeout(Oe(ke().mark((function e(){return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.gameController.performAttack(n,o),r();case 2:case"end":return e.stop()}}),e)}))),t.delay):t.moveToTarget(n,o).then((function(){r()})).catch(Oe(ke().mark((function n(){var o,a;return ke().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=t.potentialActions.findIndex((function(t){return t===e})),t.potentialActions.splice(o,1),!(a=t.findBestAction(t.potentialActions))){n.next=9;break}return n.next=6,t.performBestAction(a);case 6:r(),n.next=11;break;case 9:console.log("Dead end, try smth else."),r();case 11:case"end":return n.stop()}}),n)}))))}))}},{key:"calculatePriority",value:function(e,t){var r=e.character,n=e.position,o=r.moveRange,a=r.attackRange,i=this.movement.calcDistance(n,t.position).distance,c=Math.ceil((i-1)/(o+a-1)),l=r.calculateDamage(t.character);return 1/(Math.ceil(t.character.health/l)+c)}},{key:"pushCharActions",value:function(e){var t,r=Ce(this.playerCharacters);try{for(r.s();!(t=r.n()).done;){var n=t.value,o={actor:e,target:n,priority:this.calculatePriority(e,n)};this.potentialActions.push(o)}}catch(e){r.e(e)}finally{r.f()}}},{key:"findBestAction",value:function(e){var t,r,n=0,o=Ce(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;a.priority>n&&(n=a.priority,t=a)}}catch(e){o.e(e)}finally{o.f()}return t}},{key:"moveToTarget",value:function(e,t){var r=this;return new Promise((function(n,o){if(!r.actionIsDone){var a=e.character.moveRange,i=e.position,c=r.movement.calcDistance(i,t.position),l=c.verticalDifference,u=c.horizontalDifference,s=l<0,f=u<0;Math.abs(l)>a-1?l=a:0!==l&&(l=Math.abs(l)-1),Math.abs(u)>a-1?u=a:0!==u&&(u=Math.abs(u)-1),s&&(l*=-1),f&&(u*=-1);for(var h=r.movement.calcPosByDifference(i,{verticalDifference:l,horizontalDifference:u});!r.gameController.emptyCell(h)&&(Math.abs(l)>0||Math.abs(u)>0);)Math.abs(l)>Math.abs(u)?l+=s?1:-1:u+=f?1:-1,h=r.movement.calcPosByDifference(i,{verticalDifference:l,horizontalDifference:u});h!==i?setTimeout((function(){r.movement.moveCharacter(e,h),n()}),r.delay):o(new Error("Нет очевидного пути"))}}))}}],r&&Se(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Re(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ae(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"from",value:function(e){var t,r=e.positions,n=e.currentTurn,o=e.currentLevel,a=e.points,i=[],c=Re(r);try{for(c.s();!(t=c.n()).done;){var l=t.value,u=l.character,s={position:l.position,properties:_e({},u),constructorName:u.type};i.push(s)}}catch(e){c.e(e)}finally{c.f()}return{currentTurn:n,currentLevel:o,points:a,savedPositions:i}}},{key:"getSavedData",value:function(e){var t,r=e.currentTurn,n=e.currentLevel,o=e.points,a=[],i=[],c=[],l=Re(e.savedPositions);try{for(l.s();!(t=l.n()).done;){var u=t.value,s=u.position,f=u.properties,h=u.constructorName,p=new(0,this.characterClasses[h])(1);for(var y in f)p[y]=f[y];var d=new de(p,s);c.push(d),"player"===p.side?a.push(p):i.push(p)}}catch(e){l.e(e)}finally{l.f()}return{playerChar:a,enemyChar:i,gameControllerProperties:{currentTurn:r,currentLevel:n,points:o,positions:c}}}}],null&&Ue(t.prototype,null),r&&Ue(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function De(){De=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),c=new P(o||[]);return n(i,"_invoke",{value:L(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f={};function h(){}function p(){}function y(){}var d={};l(d,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==t&&r.call(m,a)&&(d=m);var b=y.prototype=h.prototype=Object.create(d);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function o(n,a,i,c){var l=s(e[n],e,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==Ne(f)&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,i,c)}),(function(e){o("throw",e,i,c)})):t.resolve(f).then((function(e){u.value=e,i(u)}),(function(e){return o("throw",e,i,c)}))}c(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function L(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return{value:void 0,done:!0}}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=x(i,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=s(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=y,n(b,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:p,configurable:!0}),p.displayName=l(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},g(w.prototype),l(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},g(b),l(b,c,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function Ie(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function ze(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ie(a,n,o,i,c,"next",e)}function c(e){Ie(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Fe(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Be(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Ge(Me,"characterClasses",{daemon:B,swordman:ee,magician:Z,bowman:M,undead:ie,vampire:he});var qe=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.stateService=r,this.movement=new me(t,this),this.playerCharacterTypes=[ee,Z,M],this.currentLevel=0,this.currentTurn="player",this.selectedChar=null,this.enemyLogic=new je(this),this.playerOptions={side:"player",allowedTypes:[ee,Z,M],maxLevel:1,characterCount:2}}var t,r,n,o;return t=e,r=[{key:"init",value:function(){var e=this;this.gamePlay.addCellEnterListener((function(t){return e.onCellEnter(t)})),this.gamePlay.addCellClickListener((function(t){return e.onCellClick(t)})),this.gamePlay.addCellLeaveListener((function(t){return e.onCellLeave(t)})),this.gamePlay.addNewGameListener((function(){return e.startNewGame()})),this.gamePlay.addLoadGameListener((function(){return e.loadHandler()})),this.gamePlay.addSaveGameListener((function(){var t=Me.from(e);e.stateService.save(t),console.log(1),null!=t&&alert("You saved your game."),console.log(2)})),this.startNewGame()}},{key:"loadHandler",value:function(){var e;console.log(1);try{console.log(2),e=this.stateService.load(),console.log(2)}catch(e){return void this.gamePlay.showMessage(e.message)}console.log(3);var t=Me.getSavedData(e),r=t.gameControllerProperties,n=t.playerChar,o=t.enemyChar;for(var a in r)this[a]=r[a];this.playerTeam.characters=n,this.enemyTeam.characters=o,this.gamePlay.changeTheme(this.currentLevel),this.redrawPositions(),"enemy"===this.currentTurn&&this.enemyTurn(),alert("You load last save.")}},{key:"startNewGame",value:function(){this.points=0,this.playerTeam=new O(this.playerOptions),this.enemyTeam=this.generateEnemyTeam(),this.positions=[],this.positionChars(this.playerTeam,this.enemyTeam),this.currentLevel=0,this.startNextLevel(),this.gamePlay.addSong(),this.redrawPositions()}},{key:"startNextLevel",value:function(){if(this.currentLevel+=1,this.currentLevel>4&&(this.gamePlay.showMessage("You win,let`s go it again!"),this.startNewGame()),this.isLevelStart=!0,this.currentTurn="player",this.selectedChar=null,this.gamePlay.drawUi(v[this.currentLevel]),this.currentLevel>1){this.calculatePoints(),this.positions=[],this.playerTeam.charactersLevelUp();var e=this.currentLevel-1;this.playerTeam.addNewCharacter(this.playerCharacterTypes,e,e),this.enemyTeam=this.generateEnemyTeam(),this.positionChars(this.playerTeam,this.enemyTeam),this.redrawPositions()}}},{key:"generateEnemyTeam",value:function(){var e={side:"enemy",allowedTypes:[B,ie,he],maxLevel:this.currentLevel,characterCount:this.playerTeam.length};return new O(e,this)}},{key:"generatePosition",value:function(e){var t=this.gamePlay.boardSize;return Math.floor(Math.random()*t)*t+Math.floor(2*Math.random())+("enemy"===e?t-2:0)}},{key:"positionChars",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var n=0,o=t;n<o.length;n++){var a,i=o[n],c=Fe(i);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=void 0;do{u=this.generatePosition(i.side)}while(this.getCharByPosition(u));var s=new de(l,u);this.positions.push(s)}}catch(e){c.e(e)}finally{c.f()}}}},{key:"availableForAttackCell",value:function(e,t){var r=e.character,n=e.position,o=this.getCharByPosition(t),a=this.movement.calcDistance(n,t).distance;return o&&r.attackRange>=a}},{key:"calculatePoints",value:function(){var e,t=0,r=Fe(this.playerTeam);try{for(r.s();!(e=r.n()).done;)t+=e.value.health}catch(e){r.e(e)}finally{r.f()}this.points+=t,document.querySelector(".user-points").textContent="Your points: ".concat(this.points)}},{key:"getTeamPositions",value:function(e){return this.positions.filter((function(t){return t.character.side===e}))}},{key:"getCharByPosition",value:function(e){return this.positions.find((function(t){return t.position===e}))||null}},{key:"removePosChar",value:function(e){var t=this.positions.findIndex((function(t){return t===e}));if(-1===t)throw new Error("You can`t just delete non-existent character");this.positions.splice(t,1),this.selectedChar===e&&(this.selectedChar=null)}},{key:"redrawPositions",value:function(){if(this.gamePlay.redrawPositions(this.positions),this.selectedChar){var e=this.selectedChar.position;this.gamePlay.selectCell(e,"yellow")}}},{key:"selectEnemyCharacter",value:function(e){this.gamePlay.selectCell(e,"red")}},{key:"deselectEnemyCharacter",value:function(e){e?this.gamePlay.deselectCell(e):document.querySelectorAll("selected-red").forEach((function(e){return e.classList.remove("selected-red")}))}},{key:"switchTurn",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(r){if(e.isLevelStart)return e.gamePlay.isPlayerFrozen=!1,void(e.currentTurn="player");e.currentTurn="player"===e.currentTurn?"enemy":"player",setTimeout((function(){"enemy"===e.currentTurn?e.enemyTurn():e.playerTurn(),r()}),t)}))}},{key:"enemyTurn",value:(o=ze(De().mark((function e(){return De().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gamePlay.isPlayerFrozen=!0,this.gamePlay.setCursor(Le),e.next=4,this.enemyLogic.doAction();case 4:return e.next=6,this.switchTurn(100);case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"playerTurn",value:function(){this.gamePlay.isPlayerFrozen=!1,this.onCellEnter(this.gamePlay.lastEnteredCellIndex)}},{key:"commitTeamDefeat",value:function(e){"player"===e?(this.gamePlay.showMessage("You lose. Try again?"),this.startNewGame()):this.startNextLevel()}},{key:"removeCharacter",value:function(e,t){var r="player"===t?this.playerTeam:this.enemyTeam;this.removePosChar(e),r.removeCharacter(e.character),r.length||this.commitTeamDefeat(t)}},{key:"performPlayerAction",value:function(e,t){if(this.isLevelStart=!1,"attack"===e){var r=this.getCharByPosition(t);this.performAttack(this.selectedChar,r)}else this.movement.moveCharacter(this.selectedChar,t)}},{key:"performAttack",value:function(e,t){var r=e.character,n=t.character,o=r.calculateDamage(n);n.health-=o,this.gamePlay.showDamage(t.position,o),n.health<=0&&this.removeCharacter(t,n.side),"player"===n.side&&this.gamePlay.deselectCell(t.position),this.redrawPositions()}},{key:"onCellClick",value:(n=ze(De().mark((function e(t){var r;return De().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=document.querySelectorAll("selected")[0])&&r.classList.remove("selected","selected-yellow"),!this.selectedChar||!this.movement.availableForMoveCell(this.selectedChar,t)){e.next=7;break}return this.performPlayerAction("move",t),e.next=6,this.switchTurn();case 6:return e.abrupt("return");case 7:if(this.playerCell(t)&&(this.gamePlay.selectCell(t),this.selectedChar=this.getCharByPosition(t)),!this.enemyCell(t)){e.next=13;break}if(!this.selectedChar||!this.availableForAttackCell(this.selectedChar,t)){e.next=13;break}return this.performPlayerAction("attack",t),e.next=13,this.switchTurn();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onCellEnter",value:function(e){if(this.emptyCell(e))this.selectedChar&&this.cursorAtEmptyCell(this.selectedChar,e);else{var t=this.positions.find((function(t){return t.position===e})).character,r="🎖".concat((n=t).level," | ⚔").concat(n.attack," | 🛡").concat(n.defence," | ❤").concat(n.health);this.gamePlay.showCellTooltip(r,e)}var n;this.playerCell(e)&&this.gamePlay.setCursor(ge),this.selectedChar&&this.enemyCell(e)&&this.cursorAtEnemyCell(this.selectedChar,e)}},{key:"onCellLeave",value:function(e){var t;(null===(t=this.selectedChar)||void 0===t?void 0:t.position)!==e&&this.gamePlay.deselectCell(e),this.gamePlay.setCursor(be),this.gamePlay.cells[e].classList.contains("character")&&this.gamePlay.hideCellTooltip(e)}},{key:"getCellChildIndex",value:function(e){return this.gamePlay.cells[e].firstChild}},{key:"playerCell",value:function(e){var t=this.getCellChildIndex(e);return null==t?void 0:t.classList.contains("player")}},{key:"enemyCell",value:function(e){var t=this.getCellChildIndex(e);return null==t?void 0:t.classList.contains("enemy")}},{key:"emptyCell",value:function(e){return!this.getCellChildIndex(e)}},{key:"cursorAtEnemyCell",value:function(e,t){this.availableForAttackCell(e,t)?(this.gamePlay.setCursor(we),this.gamePlay.selectCell(t,"red-dashed")):this.gamePlay.setCursor(Le)}},{key:"cursorAtEmptyCell",value:function(e,t){this.movement.availableForMoveCell(e,t)?(this.gamePlay.setCursor(ge),this.gamePlay.selectCell(t,"green")):this.gamePlay.setCursor(Le)}}],r&&Ye(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var He=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t}var t,r;return t=e,(r=[{key:"save",value:function(e){this.storage.setItem("state",JSON.stringify(e))}},{key:"load",value:function(){var e;try{e=JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}if(!e)throw new Error("no saved data");return e}}])&&$e(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),We=new L;We.bindToDOM(document.querySelector("#game-container")),new qe(We,new He(localStorage)).init(),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.log("SW registration failed: ",e)}))}))})()})();